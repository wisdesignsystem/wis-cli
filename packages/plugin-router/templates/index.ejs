import { remotes } from './config'

function isDebug() {
  return new URLSearchParams(window.location.search).get('debug') !== null
}

(async () => {
  let urls = await remotes()

  const appName = '<%= appName %>'

  if (!urls[appName]) {
    urls[appName] = process.env.PUBLIC_URL.slice(0, process.env.PUBLIC_URL.length - 1)
  }

  window.$__wis_raw_remotes__ = { ...urls }
  if (isDebug()) {
    try {
      const localUrls = window.sessionStorage.getItem(`${appName}__wis_remotes__`)
      urls = localUrls ? Object.assign(urls, JSON.parse(localUrls)) : urls
    } catch (e) {}
  }
  window.$__wis_remotes__ = { ...urls }
  window.$__wis_uncheck_remote__ = function (name) {
    return urls[name]
  }

  import(/* webpackChunkName: "bootstrap" */'./bootstrap')
})()
